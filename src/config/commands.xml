<?xml version="1.0"?>
<commands xmlns="http://technosophos.com/2009/1.1/commands.xml">
  
  <!-- 
  <include path="test/Tests"/>  
  -->
  
  <!--
  Bootstrap sequence.
  -->
  <group name="bootstrap">
    <cmd name="lanternDB" invoke="LanternDB">
      <!--param name="server">mongodb://user:pass@localhost:27017</param-->
      <param name="server">mongodb://localhost:27017</param>
    </cmd>
    <cmd name="db" invoke="LanternSelectDB">
      <param name="databaseName">LanternNotes</param>
      <param name="databaseConnection" from="cxt:lanternDB"/>
    </cmd>
    <cmd name="init" invoke="LanternInitialize"/>
  </group>
  
  <!--
  Send formatted data to the client.
  -->
  <group name="output">
    <cmd name="tpl" invoke="LanternRenderMainHTML">
      <!-- param name="variables" from=""/-->
      <param name="template">tpl/main.tpl.php</param>
      <param name="themeDir">themes/vanilla</param>
    </cmd>

    <!--
    <cmd name="dump" invoke="FortissimoContextDump">
      <param name="html">true</param>
    </cmd>
    -->

    
    <cmd name="sendToOut" invoke="LanternOutput">
      <param name="buffer" from="cxt:tpl"/>
    </cmd>
  </group>
  
  <!--
  Installer.
  -->
  <request name="install">
    <cmd name="mainInstaller" invoke="LanternInstaller"/>
    <cmd group="output"/>
  </request>
  
  <!--
  Uninstaller
  -->
  <request name="uninstall">
    <cmd group="bootstrap"/>
    <cmd name="uninstallAll" invoke="LanternUninstall"/>
  </request>
     
     
  <!-- The default request will be executed when the index is loaded. -->
  <request name="default">    
    <!-- Invoke all commands in the bootstrap group. -->
    <cmd group="bootstrap"/>
    
    
    
    
    
    <cmd group="output"/>
  </request>
  
  <request name="edit-journal">
    <cmd group="bootstrap"/>
    
    <cmd name="cxtMod" invoke="LanternAddToContext">
      <param name="head_title">Foo</param>
      <param name="styles">themes/vanilla/css/style.css</param>
    </cmd>
    
    <cmd name="body" invoke="LanternRender">
      <param name="template">tpl/journal_edit.tpl.php</param>
      <param name="themeDir">themes/vanilla</param>
    </cmd>
    
    <cmd group="output"/>
  </request>
  
  <request name="save-journal">    
    <!-- Invoke all commands in the bootstrap group. -->
    <cmd group="bootstrap"/>
    
    <cmd name="savedEntry" invoke="LanternSaveJournal">
      <param name="title">My Second Entry</param>
      <param name="entry">This is a *test* entry body.</param>
      <param name="tags">a, b, cde</param>
      <param name="entryID">4b68fdbb8ead0e103d020000</param>
    </cmd>
    
    <!--
    <cmd name="dump" invoke="FortissimoContextDump">
      <param name="html">true</param>
    </cmd>
    -->
    
    <cmd name="body" invoke="LanternRender">
      <param name="variables" from="cxt:savedEntry"/>
      <param name="template">tpl/journal.tpl.php</param>
      <param name="themeDir">themes/vanilla</param>
    </cmd>
    
    <cmd group="output"/>
  </request>
  
  <!-- Logs directly into STDOUT (the browser, the console). -->
  <logger name="foil" invoke="FortissimoOutputInjectionLogger"/>
  
  <!-- Buffers log messages in an array to be retrieved later. 
  <logger name="fail" invoke="FortissimoArrayInjectionLogger"/>
  -->
  
  <!--
  Fortissimo supports global caches, though this is currently
  experimental.
  <cache name="dummy" invoke="FortissimoDummyRequestCache"/>
  <cache name="dummy2" invoke="FortissimoDummyRequestCache">
    <param name="param" value="foo"/>
  </cache>
  -->
</commands>